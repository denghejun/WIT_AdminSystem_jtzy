webpackJsonp([11],{"1NHp":function(a,t){},"4lub":function(a,t){},"6wGC":function(a,t){},RtTj:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=e("Xxa5"),n=e.n(i),s=e("exGp"),r=e.n(s),o=e("h9gA"),l={name:"basic-inf",props:{regionId:{type:Number}},data:function(){return{basicInf:[],buildingsArea:"",undergraduate:"",Workers:"",household:""}},methods:{refreshBasic:function(a){var t=this;this.$api.regionInf.findOne(a).then(function(a){t.basicInf=a})},refresh:function(){var a=this;this.$api.stats.findAllPage({pageNum:1,pageSize:100}).then(function(t){a.buildingsArea=t.list[2].value,a.undergraduate=t.list[14].value,a.Workers=t.list[11].value,a.household=t.list[12].value})},refresh1:function(){var a=this;this.$api.stats.findAllPage({pageNum:1,pageSize:100}).then(function(t){a.buildingsArea=t.list[16].value,a.undergraduate=t.list[17].value,a.Workers=t.list[18].value,a.household=t.list[19].value})},refresh2:function(){var a=this;this.$api.stats.findAllPage({pageNum:1,pageSize:100}).then(function(t){a.buildingsArea=t.list[20].value,a.undergraduate=t.list[21].value,a.Workers=t.list[22].value,a.household=t.list[23].value})}}},u={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"basic-box"},[e("div",{staticClass:"basic-row"},[a._m(0),a._v(" "),e("div",{staticClass:"basic-value"},[a._v(a._s(a.basicInf.area)+"㎡")]),a._v(" "),a._m(1),a._v(" "),e("div",{staticClass:"basic-value"},[a._v(a._s(a.buildingsArea)+"㎡")])]),a._v(" "),e("div",{staticClass:"basic-row"},[a._m(2),a._v(" "),e("div",{staticClass:"basic-value"},[a._v(a._s(a.basicInf.population)+"人")]),a._v(" "),a._m(3),a._v(" "),e("div",{staticClass:"basic-value"},[a._v(a._s(a.undergraduate)+"人")])]),a._v(" "),e("div",{staticClass:"basic-row"},[a._m(4),a._v(" "),e("div",{staticClass:"basic-value"},[a._v(a._s(a.Workers)+"人")]),a._v(" "),a._m(5),a._v(" "),e("div",{staticClass:"basic-value"},[a._v(a._s(a.household)+"户")])])])},staticRenderFns:[function(){var a=this.$createElement,t=this._self._c||a;return t("div",{staticClass:"basic-name"},[t("b",[this._v("占地面积")])])},function(){var a=this.$createElement,t=this._self._c||a;return t("div",{staticClass:"basic-name"},[t("b",[this._v("建筑面积")])])},function(){var a=this.$createElement,t=this._self._c||a;return t("div",{staticClass:"basic-name"},[t("b",[this._v("住校学生")])])},function(){var a=this.$createElement,t=this._self._c||a;return t("div",{staticClass:"basic-name"},[t("b",[this._v("折合本科")])])},function(){var a=this.$createElement,t=this._self._c||a;return t("div",{staticClass:"basic-name"},[t("b",[this._v("住校职工")])])},function(){var a=this.$createElement,t=this._self._c||a;return t("div",{staticClass:"basic-name"},[t("b",[this._v("住校户数")])])}]};var d=e("VU/8")(l,u,!1,function(a){e("nFfh")},"data-v-41f32c74",null).exports,c={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"meter"},[e("el-table",{attrs:{border:"",data:a.tableData,size:"mini",height:"100%"}},[e("el-table-column",{attrs:{label:"序号",type:"index",align:"center"}}),a._v(" "),a._l(a.tableColumn,function(a,t){return e("el-table-column",{key:t,attrs:{label:a.name,prop:a.prop,align:"center"}})}),a._v(" "),e("el-table-column",{attrs:{label:"地图定位",align:"center"},scopedSlots:a._u([{key:"default",fn:function(t){return[e("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-location"},on:{click:function(e){return a.locateMeter(t.row)}}})]}}])})],2)],1)},staticRenderFns:[]};var v=e("VU/8")({name:"meter-inf",data:function(){return{tableData:[],tableColumn:[{name:"水表名称",prop:"name"},{name:"水表编号",prop:"snumber"},{name:"通讯编号",prop:"comno"},{name:"出厂编号",prop:"productsn"},{name:"水表类型",prop:"category"},{name:"材质",prop:"material"},{name:"规格",prop:"dimension"}]}},methods:{refreshWaterMeter:function(a){var t=this;this.$api.waterMeterInf.findByRegionId(a).then(function(a){t.tableData=a})},locateMeter:function(a){var t=this,e=void 0,i=void 0,n=void 0;this.$api.waterMeterInf.findOne(a.id).then(function(a){e=a.name,i=a.tag.substring(1,a.tag.length-1).split(",")[0],n=a.tag.substring(1,a.tag.length-1).split(",")[1],t.$router.push({path:"/BmapGL",query:{marker:{lng:i,lat:n},info:e}})})}}},c,!1,function(a){e("4lub")},"data-v-c82a8a60",null).exports,f={name:"water-index",data:function(){return{flow:"--",buildingArea:"",population:"",personFlow:"--",buildingAreaFlow:"--"}},methods:{dateFtt:function(a){return(a=new Date(a)).getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()},initialize:function(a){var t=this,e=new Date,i=e.getTime(),n=this.dateFtt(i),s=e.getTime()-864e5,r=this.dateFtt(s),o={pageNum:1,pageSize:1,waterregionid:a,starttime:r,endtime:n},l={pageNum:1,pageSize:100};this.$api.regionInf.findTotalFlowAnyDay(o).then(function(e){"ok"===e.msg?(t.flow=e.data.list[0].data.toFixed(1),t.$api.regionInf.findOne(a).then(function(a){t.population=a.population,t.personFlow=(t.flow/t.population*1e3).toFixed(1)}),t.$api.stats.findAllPage(l).then(function(e){t.buildingsArea=1===a?e.list[2].value:2===a?e.list[16].value:e.list[20].value;var i=Number(t.buildingsArea),n=Number(t.flow);t.buildingAreaFlow=(n/i*1e3).toFixed(1)})):(t.flow="--",t.personFlow="--",t.buildingAreaFlow="--")})},daysFlow:function(a){var t=this,e={pageNum:1,pageSize:100};this.$api.regionInf.findTotalFlowAnyDay(a).then(function(i){"ok"===i.msg?(t.flow=i.data.list[0].data.toFixed(1),t.$api.regionInf.findOne(a.waterregionid).then(function(a){t.population=a.population,t.personFlow=(t.flow/t.population*1e3).toFixed(1)}),t.$api.stats.findAllPage(e).then(function(e){1===a.waterregionid?t.buildingsArea=e.list[2].value:2===a.waterregionid?t.buildingsArea=e.list[16].value:t.buildingsArea=e.list[20].value;var i=Number(t.buildingsArea),n=Number(t.flow);t.buildingAreaFlow=(n/i*1e3).toFixed(1)})):(t.flow="--",t.personFlow="--",t.buildingAreaFlow="--")})},monthsFlow:function(a){var t=this,e={pageNum:1,pageSize:100};this.$api.regionInf.findTotalFlowAnyMonth(a).then(function(i){"ok"===i.msg?(t.flow=i.data.list[0].data.toFixed(1),t.$api.regionInf.findOne(a.waterregionid).then(function(a){t.population=a.population,t.personFlow=(t.flow/t.population/30*1e3).toFixed(1)}),t.$api.stats.findAllPage(e).then(function(e){1===a.waterregionid?t.buildingsArea=e.list[2].value:2===a.waterregionid?t.buildingsArea=e.list[16].value:t.buildingsArea=e.list[20].value;var i=Number(t.buildingsArea),n=Number(t.flow);t.buildingAreaFlow=(n/i/30*1e3).toFixed(1)})):(t.flow="--",t.personFlow="--",t.buildingAreaFlow="--")})},yearsFlow:function(a){var t=this,e={pageNum:1,pageSize:100};this.$api.regionInf.findTotalFlowAnyYear(a).then(function(i){"ok"===i.msg?(t.flow=i.data.list[0].data.toFixed(1),t.$api.regionInf.findOne(a.waterregionid).then(function(a){t.population=a.population,t.personFlow=(t.flow/t.population/365*1e3).toFixed(1)}),t.$api.stats.findAllPage(e).then(function(e){1===a.waterregionid?t.buildingsArea=e.list[2].value:2===a.waterregionid?t.buildingsArea=e.list[16].value:t.buildingsArea=e.list[20].value;var i=Number(t.buildingsArea),n=Number(t.flow);t.buildingAreaFlow=(n/i/365*1e3).toFixed(1)})):(t.flow="--",t.personFlow="--",t.buildingAreaFlow="--")})}}},g={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"water-box"},[a._m(0),a._v(" "),e("div",{staticClass:"index-value"},[e("div",[a._v(a._s(a.flow)+"吨")]),a._v(" "),e("div",[a._v(a._s(a.personFlow)+"升")]),a._v(" "),e("div",[a._v(a._s(a.buildingAreaFlow)+"升")])])])},staticRenderFns:[function(){var a=this.$createElement,t=this._self._c||a;return t("div",{staticClass:"index-name"},[t("div",[t("b",[this._v("当前用量")])]),this._v(" "),t("div",[t("b",[this._v("生均单耗")])]),this._v(" "),t("div",[t("b",[this._v("建面单耗")])])])}]};var h=e("VU/8")(f,g,!1,function(a){e("x+tA")},"data-v-75e125dd",null).exports,p={name:"quota-table",data:function(){return{table:[{name:"用量"},{name:"定额"},{name:"节水"}],tableColumn:[{name:"月份",prop:"name"},{name:"01",prop:"1"},{name:"02",prop:"2"},{name:"03",prop:"3"},{name:"04",prop:"4"},{name:"05",prop:"5"},{name:"06",prop:"6"},{name:"07",prop:"7"},{name:"08",prop:"8"},{name:"09",prop:"9"},{name:"10",prop:"10"},{name:"11",prop:"11"},{name:"12",prop:"12"},{name:"已用累计",prop:"count"}]}},created:function(){this.table=this.tableData},props:{tableData:{type:Array}},methods:{}},m={render:function(){var a=this.$createElement,t=this._self._c||a;return t("div",{staticClass:"quota-box"},[t("el-table",{attrs:{border:"",data:this.table,size:"mini"}},this._l(this.tableColumn,function(a,e){return t("el-table-column",{key:e,attrs:{label:a.name,prop:a.prop,align:"center"}})}),1)],1)},staticRenderFns:[]};var b=e("VU/8")(p,m,!1,function(a){e("zll3")},"data-v-6d29160b",null).exports,_={components:{SavingBarChartS:e("DQ4D").a},name:"quota-chart",data:function(){return{quotaData:[],usageData:[],savingData:[],basicInf:{}}},created:function(){this.quotaData=this.quota,this.usageData=this.usage,this.savingData=this.saving,this.basicInf=this.savingInf},props:{quota:{type:Array},usage:{type:Array},saving:{type:Array},savingInf:{type:Object}}},w={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"chart-box"},[e("div",{staticClass:"chart-row"},[e("div",[e("saving-bar-chart-s",{attrs:{quota:a.quotaData,usage:a.usageData,saving:a.savingData}})],1)]),a._v(" "),e("div",{staticClass:"count-row"},[e("div",[a._v("当年定额(吨)："+a._s(a.basicInf.currentQuota))]),a._v(" "),e("div",[a._v("已用累计(吨)："+a._s(a.basicInf.usage))]),a._v(" "),e("div",[a._v("已用节水(吨)："+a._s(a.basicInf.saving))]),a._v(" "),e("div",[a._v("已用节水率(%)："+a._s(a.basicInf.ratio))])])])},staticRenderFns:[]};var x=e("VU/8")(_,w,!1,function(a){e("6wGC")},"data-v-74ca8aa2",null).exports,C=e("uwMp"),I=e("mF0L"),F={components:{QuotaChart:x,QuotaTable:b,WaterIndex:h,MeterInf:v,BasicInf:d,SelectCampus:o.a,RadioGroup1:C.a},name:"campus-water-use-overview",data:function(){return{dateRadio:1,quotaRadio:"1",regionId:1,imageData:[],savingInf:{},quota:[],usage:[],saving:[],show:!1,year:(new Date).getFullYear(),start:"",end:"",columns:[{name:"月份",prop:"name"},{name:"01",prop:"1"},{name:"02",prop:"2"},{name:"03",prop:"3"},{name:"04",prop:"4"},{name:"05",prop:"5"},{name:"06",prop:"6"},{name:"07",prop:"7"},{name:"08",prop:"8"},{name:"09",prop:"9"},{name:"10",prop:"10"},{name:"11",prop:"11"},{name:"12",prop:"12"},{name:"已用累计",prop:"count"}],tableData:[],title:"校区节水概况与定额管理"}},mounted:function(){this.$refs.basicInfo.refreshBasic(this.regionId),this.$refs.basicInfo.refresh(),this.$refs.meterInfo.refreshWaterMeter(this.regionId),this.$refs.flowInfo.initialize(this.regionId),this.getRegionPic();var a=(new Date).getFullYear();this.year=a,this.start=a+"-01",this.end=Number(a)+1+"-01",this.getBasicData()},methods:{exportData:function(){Object(I.a)(this.columns,this.tableData,this.title)},changeYear:function(){var a=(new Date).getFullYear();switch(this.quotaRadio){case"1":a=a;break;case"2":a-=1}this.year=a,this.start=a+"-01",this.end=Number(a)+1+"-01",this.getBasicData()},getBasicData:function(){var a=this;return r()(n.a.mark(function t(){var e,i,s,r,o,l,u;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.show=!1,e=(new Date).getFullYear(),i=a.year,s=a.regionId,r={waterregionid:s,quotayear:i},t.next=7,a.$api.waterRegionQuota.findAll(r);case 7:return o=(o=t.sent)&&o.data&&o.data.length>0?o.data[0]:[],l={pageNum:1,pageSize:12,waterregionid:s,starttime:a.start,endtime:a.end},t.next=12,a.$api.regionData.findTimesMonthFlow(l);case 12:(u=(u=t.sent)&&u.data&&u.data.list&&u.data.list.length>0?u.data.list:[]).length>0&&i==e&&u.pop(),a.getSavingData(o,u);case 16:case"end":return t.stop()}},t,a)}))()},getSavingData:function(a,t){for(var e,i,n=void 0,s=void 0,r=void 0,o=void 0,l=void 0,u=[],d=[],c=[],v=[{name:"用量"},{name:"定额"},{name:"节水"}],f=0,g=0,h=0,p=0;p<=11;p++){var m=0;n="m"+(p+1),s=p+1+"",r=a&&a[n]?Number(a[n]).toFixed(0):0,p<t.length&&(m=Number(t[p].data).toFixed(0),g+=Number(m),f+=Number(r)),v[0][s]=0==m?"--":m,v[1][s]=r,h+=Number(r),o=r>0&&0!=m?r-m:0,l=r>0&&0!=m?r-m:"--",v[2][s]=l,u.push(r),d.push(m),c.push({value:o<0?-1*o:o,flag:o<0})}g=Number(g).toFixed(0),e=f>0&&0!=g?f-g:"--",i=f>0&&"number"==typeof e?(e/f*100).toFixed(1):"--",v[0].count=g,v[1].count=f,v[2].count=e,this.tableData=v,this.savingInf.currentQuota=h,this.savingInf.usage=g,this.savingInf.saving=e,this.savingInf.ratio=i,this.quota=u.map(function(a){return 0==a?null:a}),this.usage=d.map(function(a){return 0==a?null:a}),this.saving=c.map(function(a){return 0!=a.value?{value:a.value,flag:a.flag}:{value:null,flag:a.flag}}),this.show=!0},getRegionPic:function(){var a=this;this.imageData=[];var t={waterregionid:this.regionId};this.$api.waterRegionPic.findRegionPics(t).then(function(t){null==t||""===t?a.imageData.push({id:"",image:""}):(t.forEach(function(a){a.image="data:image/jpg;base64,"+a.image}),a.imageData=t)})},change:function(a){this.regionId=a.id,this.$refs.basicInfo.refreshBasic(this.regionId),1===this.regionId?this.$refs.basicInfo.refresh():2===this.regionId?this.$refs.basicInfo.refresh1():this.$refs.basicInfo.refresh2(),this.$refs.meterInfo.refreshWaterMeter(this.regionId),this.dateRadio=1,this.$refs.flowInfo.initialize(this.regionId),this.getBasicData(),this.getRegionPic()},radioChange:function(a){this.dateRadio=a.radio;var t={starttime:a.starttime,endtime:a.endtime,waterregionid:this.regionId,pageNum:1,pageSize:1},e={startyy:a.starttime,endyy:a.endtime,waterregionid:this.regionId,pageNum:1,pageSize:1};1===a.type?this.$refs.flowInfo.daysFlow(t):2===a.type?this.$refs.flowInfo.monthsFlow(t):this.$refs.flowInfo.yearsFlow(e)}}},y={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"flex"},[e("div",{staticClass:"content body"},[e("div",{staticClass:"row first-row"},[e("div",{staticClass:"col-xs-3"},[e("div",{staticClass:"box box-solid basic"},[e("div",{staticClass:"box-header bg-aqua"},[a._v("\n            校区基本信息\n          ")]),a._v(" "),e("div",{staticClass:"box-body"},[e("select-campus",{attrs:{regionId:a.regionId},on:{change:a.change}}),a._v(" "),e("div",{staticClass:"basic-inf"},[e("basic-inf",{ref:"basicInfo"})],1)],1)])]),a._v(" "),e("div",{staticClass:"col-xs-9"},[e("div",{staticClass:"box box-solid meter"},[e("div",{staticClass:"box-header bg-aqua"},[a._v("\n            校区一级监控水表\n          ")]),a._v(" "),e("div",{staticClass:"box-body"},[e("div",{staticClass:"meter-inf"},[e("meter-inf",{ref:"meterInfo"})],1)])])])]),a._v(" "),e("div",{staticClass:"row second-row"},[e("div",{staticClass:"col-xs-3"},[e("div",{staticClass:"water-index"},[e("div",{staticClass:"box box-solid"},[e("div",{staticClass:"box-header bg-aqua"},[a._v("\n              主要用水指标\n            ")]),a._v(" "),e("div",{staticClass:"box-body"},[e("div",{staticClass:"select-date"},[e("radio-group1",{attrs:{radioData:a.dateRadio},on:{radioChange:a.radioChange}})],1),a._v(" "),e("div",{staticClass:"index-data"},[e("water-index",{ref:"flowInfo"})],1)])])]),a._v(" "),e("div",{staticClass:"image"},[e("div",{staticClass:"box box-solid"},[e("div",{staticClass:"box-header bg-aqua"},[a._v("\n              校区影像\n            ")]),a._v(" "),e("div",{staticClass:"box-body"},[e("el-carousel",{attrs:{"indicator-position":"inside",height:"100%"}},a._l(a.imageData,function(a){return e("el-carousel-item",{key:a.id},[e("img",{staticClass:"carousel_image_type",attrs:{src:a.image,alt:"暂无图片"}})])}),1)],1)])])]),a._v(" "),e("div",{staticClass:"col-xs-9"},[e("div",{staticClass:"box box-solid quota"},[e("div",{staticClass:"box-header bg-aqua"},[a._v("\n            节水概况与定额管理\n          ")]),a._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:!a.show,expression:"!show"}],staticClass:"box-body"},[e("div",{staticClass:"quota-date"},[e("el-radio-group",{attrs:{size:"mini"},on:{change:a.changeYear},model:{value:a.quotaRadio,callback:function(t){a.quotaRadio=t},expression:"quotaRadio"}},[e("el-radio-button",{attrs:{label:"1"}},[a._v("今年")]),a._v(" "),e("el-radio-button",{attrs:{label:"2"}},[a._v("去年")])],1),a._v(" "),e("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-download"},on:{click:a.exportData}},[a._v("导出")])],1),a._v(" "),e("div",{staticClass:"quota-table"},[a.show?e("quota-table",{attrs:{tableData:a.tableData}}):a._e()],1),a._v(" "),e("div",{staticClass:"quota-chart"},[a.show?e("quota-chart",{attrs:{savingInf:a.savingInf,quota:a.quota,usage:a.usage,saving:a.saving}}):a._e()],1)])])])])])])},staticRenderFns:[]};var A=e("VU/8")(F,y,!1,function(a){e("1NHp")},"data-v-06b29f44",null);t.default=A.exports},nFfh:function(a,t){},"x+tA":function(a,t){},zll3:function(a,t){}});
//# sourceMappingURL=11.3268376e04d6b79dc2f0.js.map